<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>輸入密碼解鎖</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    body{display:flex;flex-direction:column;align-items:center;padding:2rem;gap:1.2rem;font-family:system-ui}
    #hint{white-space:pre-line;font-size:.95rem;line-height:1.5;color:#333;text-align:center;max-width:360px}
    form{display:flex;flex-direction:column;gap:.8rem;width:100%;max-width:280px}
    input,button{padding:.6rem;font-size:1rem;border-radius:4px}
    input{border:1px solid #ccc;text-align:center;letter-spacing:.4em}
    button{border:none;background:#2196f3;color:#fff;cursor:pointer;transition:.2s background}
    button:hover{background:#1b83d9}
  </style>
</head>
<body>
  <h2 id="placeName">解鎖地點</h2>
  <div id="hint"></div>

  <form id="codeForm">
    <input id="codeInput"
           placeholder="輸入 4 位數字"
           maxlength="4" pattern="[0-9]{4}" required>
    <button type="submit">確定</button>
  </form>

  <script type="module">
    import { PLACES } from './js/config.js';
    import { unlock } from './js/storage.js';

    // 1. 取得目標地點
    const targetId = new URLSearchParams(location.search).get('target');
    const place    = PLACES.find(p => p.id === targetId);

    if (!place){
      alert('未知地點'); history.back();
    }

    // 2. 顯示地點名稱與 hint
    document.getElementById('placeName').textContent = `解鎖「${place.name}」`;
    document.getElementById('hint').textContent      = place.hint || '請輸入 4 位密碼';

    // 3. 驗證密碼
    document.getElementById('codeForm').addEventListener('submit', e => {
      e.preventDefault();
      const val = document.getElementById('codeInput').value.trim();
      if (val === place.code){
        unlock(place.id);
        alert('✅ 解鎖成功！');
        location.href = 'game.html';
      }else{
        alert('❌ 密碼不正確，再試一次');
      }
    });
  </script>
</body>
</html>